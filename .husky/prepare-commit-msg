#!/usr/bin/env sh

# Get the commit message file
COMMIT_MSG_FILE=$1

# Read the current commit message
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

# Only process if message doesn't already have an emoji in scope
if ! echo "$COMMIT_MSG" | grep -qE "^\w+\([^)]*[ðŸ˜€-ðŸ™]\)"; then
  # Extract the type from the commit message (before colon or parenthesis)
  TYPE=$(echo "$COMMIT_MSG" | grep -oE "^[a-z]+")
  
  # Map types to emojis
  case "$TYPE" in
    feat)     EMOJI="âœ¨" ;;
    fix)      EMOJI="ðŸ›" ;;
    chore)    EMOJI="ðŸ”§" ;;
    docs)     EMOJI="ðŸ“" ;;
    refactor) EMOJI="â™»ï¸" ;;
    test)     EMOJI="âœ…" ;;
    build)    EMOJI="ðŸ“¦" ;;
    ci)       EMOJI="ðŸ‘·" ;;
    perf)     EMOJI="âš¡" ;;
    style)    EMOJI="ðŸ’„" ;;
    *)        EMOJI="" ;;
  esac
  
  # Add emoji to scope if one was found
  if [ -n "$EMOJI" ]; then
    # Check if there's already a scope
    if echo "$COMMIT_MSG" | grep -qE "^\w+\([^)]+\):"; then
      # Has scope: feat(auth): message -> feat(auth-âœ¨): message
      echo "$COMMIT_MSG" | sed -E "s/^([a-z]+)\(([^)]+)\):/\1(\2-$EMOJI):/" > "$COMMIT_MSG_FILE"
    else
      # No scope: feat: message -> feat(âœ¨): message
      echo "$COMMIT_MSG" | sed -E "s/^([a-z]+):/\1($EMOJI):/" > "$COMMIT_MSG_FILE"
    fi
  fi
fi
